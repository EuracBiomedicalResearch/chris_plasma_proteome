---
title: "Sensitivity analysis of the CHRIS MS-based plasma proteome analysis"
author: "Nikola Dordevic, Johannes Rainer"
graphics: yes
output:
  BiocStyle::html_document:
    toc_float: true
    code_folding: hide
#bibliography: references.bib
---

**Modified**: `r file.info("sensitivity_analysis_sex_age_bmi_associated_proteins.Rmd")$mtime`<br />
**Compiled**: `r date()`

```{r biocstyle, echo = FALSE, results = "hide", message = FALSE}
#' rmarkdown format settings
library(BiocStyle)
library(knitr)
BiocStyle::markdown()
```

```{r settings, echo = FALSE}
#' General settings
filename <- "sensitivity_analysis_sex_age_bmi_associated_proteins"
#' Path to save images to
IMAGE_PATH <- paste0("images/", filename, "/")
if (file.exists(IMAGE_PATH))
    unlink(IMAGE_PATH, recursive = TRUE)
dir.create(IMAGE_PATH, recursive = TRUE)
#' Path to store RData files
RDATA_PATH <- paste0("data/RData/", filename, "/")
dir.create(RDATA_PATH, recursive = TRUE, showWarnings = FALSE)
#' wheter interactive plots should be used. Should be set to FALSE if report
#' is to be shared with external researchers.
PLOTLY <- FALSE
ggplotly_or_not <- function(x, interactive = TRUE) {
    if (interactive) ggplotly(x)
    else print(x)
}
opts_chunk$set(message = FALSE, warning = FALSE, fig.width = 8,
               fig.height = 7, fig.path = IMAGE_PATH)
chris_path <- "."
```

# Introduction

This document provides sensitivity annalysis of identification plasma proteins 
that are associated to age, sex and body mass index (BMI) using the CHRIS 
ScanningSWATH mass spectrometry (MS)-based plasma proteome data set.
Additional visualizations are provided!

# Data import

Below we load the data and all required libraries. The data is loaded from the
CHRIS TDFF modules.

```{r data-libraries}
library(chrisUtils)
library(chrisData)
library(RColorBrewer)
library(pander)
library(pheatmap)
library(DT)
library(ggfortify)
library(ggplot2)
library(ggpubr)
library(reshape2)
library(plotly)
options(rgl.useNULL = TRUE)
library(rgl)
library(readxl)
library(writexl)
library(tidyfr)
mdl <- data_module("chris_scanningswath_proteins", "1.0.0.1", chris_path)
prot_data <- data(mdl)
prot_ann <- labels(mdl)
stopifnot(all(colnames(prot_data) == rownames(prot_ann)))
colnames(prot_data) <- prot_ann$description
rownames(prot_ann) <- prot_ann$description
## define the columns with protein concentrations
proteins <- rownames(prot_ann)[prot_ann$Genes != ""]
```

Before proceeding with the data analysis we remove the POOL samples. In addition
we restrict to samples from the CHRIS study.

```{r remove-POOLs-NAFLDs, message = FALSE, warning = FALSE}
prot_data <- prot_data[grep("^001", rownames(prot_data)), ]
```

Next we define the various variables which will be included in the analysis.
First we define and add the BMI data, both as a numeric value, but also using
the BMI categories. For the BMI categories we are using *2* (18.5 - <25) as
baseline since that is supposed to be the *normal*.

```{r define-variables-bmi, message = FALSE, warning = FALSE}
clin <- chrisData("clinical")
rownames(clin) <- clin$AID
## Adding this information to the colData
prot_data$BMI <- clin[rownames(prot_data), "x0an03q"]
prot_data$BMIcat <- factor(as.integer(clin[rownames(prot_data), "x0an03b"]),
                           levels = c("2", "1", "3", "4"))
```

We also define the season in which samples were collected from the study
participants and add the age and sex information for each study participant.

```{r define-variables-general-info, message = FALSE}
## add here phenotype data from chrisData and recalculate season from exam day
gen_info <- chrisData("general_information", release = "baseline")
rownames(gen_info) <- gen_info$AID
prot_data$Season <- as.factor(season(gen_info[rownames(prot_data), "x0_examd"]))
prot_data$Sex <- gen_info[rownames(prot_data), "x0_sex"]
prot_data$Age <- gen_info[rownames(prot_data), "x0_age"]
```

Import information for pregnancy:

```{r define-variables-pregnant, message = FALSE}
interview_info <- chrisData("interview", release = "baseline")
rownames(interview_info) <- interview_info$AID
## Add pregnancy information
prot_data$Pregnant <- interview_info[rownames(prot_data), "x0wo05"]
```

A categorical variable for fasting status is defined based self-reported data
from the participants' interview.

```{r define-variables-fasting, message = FALSE}
## add number of people reporting fasting status (`x0bc12` from `chrisData`
## `"labdata"`)
labdata_info <- chrisData("labdata", release = "baseline")
rownames(labdata_info) <- labdata_info$AID
prot_data$Fasting <- labdata_info[rownames(prot_data), "x0bc12"]
```

At last we load also the medication data which might be used later to test for
potential confounding.

```{r}
medi <- chrisData("drugs_1")
library(atc)
```

Create additional variable for age! Coefficients and effect sizes correspond to 
one year difference. Dividing age with 10, difference in coefficents and effect 
sizes would correspond to 10 years difference and it would be easier to define 
meaningful cut-off!
 
```{r define-age10-variable, message = FALSE}
prot_data$Age_10 <- prot_data$Age/10
```


# General data overview

In resulting dataset, there are `r nrow(prot_data)` samples in total and
general overview of the trait is summarized below:

```{r, message=FALSE}
Overview <- summary(
    prot_data[, c("Sex", "Fasting", "Age", "Age_10", "Season", "BMIcat",
                  "Pregnant", "Fasting")])
print(Overview)
```

We further remove all individuals with missing values for any of the required
variables (age, sex, fasting and BMI) as well as pregnant women.

```{r}
nas <- is.na(prot_data[, c("Sex", "Fasting", "Age", "BMIcat")])
prot_data <- prot_data[rowSums(nas) == 0, ]
## remove pregnant women
rem <- c(which(prot_data$Pregnant == "Yes"),
         which(prot_data$Pregnant == "Don't know, possible"))
prot_data <- prot_data[-rem, ]
```

Summary for the final data set.

```{r}
prot_data[, c("Sex", "Fasting", "Age", "Age_10", "Season", "BMIcat",
              "Pregnant", "Fasting")] %>% summary()
```

This reduces the data set to `r nrow(prot_data)` individuals.

We next define the categorical variable for *hormonal contraceptives* using the
ATC level 3 medication information from CHRIS. In particular, we define the
trait using the ATC3 categories *HORMONAL CONTRACEPTIVES FOR SYSTEMIC USE* and
*ANTIANDROGENS*. This definition is similar to the one in Ramsey et al
[@ramsey_variation_2016] that considered women taking oral contraceptives.

```{r, warning = FALSE}
## approach 1
med <- chrisData("drugs_1")
med <- med[med$AID %in% rownames(prot_data), ]
med <- med[!is.na(med$x0dd03), ]
med$atc_2 <- toAtcLevel(med$x0dd03, level = 2)
med$atc_3 <- toAtcLevel(med$x0dd03, level = 3)
med$atc_4 <- toAtcLevel(med$x0dd03, level = 4)
atc_df <- as.data.frame(atc)
med$atc_2_name <- atc_df[match(med$atc_2, atc_df$key), "name"]
med$atc_3_name <- atc_df[match(med$atc_3, atc_df$key), "name"]
med$atc_4_name <- atc_df[match(med$atc_4, atc_df$key), "name"]
## Subset to selected sex hormone treatment.
med_sex_horm <- med[med$atc_3_name %in%
                    c("HORMONAL CONTRACEPTIVES FOR SYSTEMIC USE",
                      "ANTIANDROGENS"), ]
prot_data$Sex_horm <- "No"
prot_data$Sex_horm[match(med_sex_horm$AID, rownames(prot_data))] <- "Yes"
prot_data$Sex_horm <- factor(prot_data$Sex_horm,
                             levels = c("No", "Yes"))
summary(prot_data$Sex_horm)
```

Check number of BMI categories per Sex:

```{r}
table(prot_data$Sex, prot_data$BMIcat)
```

Visualize BMI numeric per Sex in histogram with group means:

```{r, hist_sex_bmi_figure, fig.path = IMAGE_PATH, fig.width = 3, fig.height = 6}
##
MeanSex <- aggregate(prot_data$BMI, list(prot_data$Sex), mean)
##
#MedianSex <- aggregate(prot_data$BMI, list(prot_data$Sex), median)
##
histBMI_Sex <- ggplot(prot_data, aes(x = BMI, fill = Sex, color = Sex)) +
                geom_histogram(position="identity", alpha=0.5, fill = "white") + 
                geom_vline(data = MeanSex, aes(xintercept = x, 
                color = Group.1), linetype="dashed") +
                scale_color_manual(values=c("blue", "red")) 
ggplotly(histBMI_Sex) 
```                                       



Perform Kolmogorov-Smirnov test to see if Sex and BMI are from the same 
distributions:

```{r}
#perform Kolmogorov-Smirnov test
ks.test(prot_data$Sex, prot_data$BMI)
```

From the output we can see that the test statistic is 1 and the corresponding 
p-value is < 2.2e-16. Since the p-value is less than 0.05, we reject the null 
hypothesis. We have sufficient evidence to say that the two sample datasets do 
not come from the same distribution.

Perform Kolmogorov-Smirnov test to see if Sex_hormones and Age are from the same 
distributions:

```{r}
#perform Kolmogorov-Smirnov test
ks.test(prot_data$Sex_horm, prot_data$Age)
```

From the output we can see that the test statistic is 1 and the corresponding 
p-value is < 2.2e-16. Since the p-value is less than 0.05, we reject the null 
hypothesis. We have sufficient evidence to say that the two sample datasets do 
not come from the same distribution.

Perform Chi-Squared test to see if Sex and Sex_horm are dependent:

```{r}
##
chisq.test(prot_data$Sex, prot_data$Sex_horm, correct=FALSE)
```

We have a chi-squared value of 274.85. Since we get a p-Value < 2.2e-16, we 
reject the null hypothesis and conclude that the two variables are dependent.

 
# Sensitivity analysis

To investigate effect of possible non-indipendent covariates affects our results 
linear regressions are fitted with and without interactions and results (effect 
sizes and p-values) are compared in scatter plots.
Linear regression models are fitted for all proteins separately (as a response) 
and sex, age, fasting status and (categorical) BMI as a covariates. In addition, 
and based on the observations from the previous section, a categorical variable 
representing use of hormonal contraceptives is included to adjust for the 
influence of this factor. 

```{r, message=FALSE}
## make a function for LM - Model 1:
FunForLinReg <- function(AnalyteName, Data) {
    Analyte <- Data[, AnalyteName]
    LMReg <- lm(Analyte ~ Sex + Age_10 + Fasting + BMIcat + Sex_horm,
                data = Data)
    res <- coef(summary(LMReg))[-1, ]
    p.Values <- data.frame(c(res[, 1],
                             res[, 4]))
    names(p.Values) <- AnalyteName
    rownames(p.Values) <- c(paste0("coef_", rownames(res)),
                            paste0("p-value_", rownames(res)))
    return(p.Values)
}

## make a function for LM - Model 2:
FunForLinReg2 <- function(AnalyteName, Data) {
    Analyte <- Data[, AnalyteName]
    LMReg <- lm(Analyte ~ Sex * BMIcat + Age_10 + Fasting + Sex_horm,
                data = Data)
    res <- coef(summary(LMReg))[-1, ]
    p.Values <- data.frame(c(res[, 1],
                             res[, 4]))
    names(p.Values) <- AnalyteName
    rownames(p.Values) <- c(paste0("coef_", rownames(res)),
                            paste0("p-value_", rownames(res)))
    return(p.Values)
}

## Model 1
## do it in one run
LMRegtests <- do.call(
    cbind, lapply(proteins, function(x) FunForLinReg(x, prot_data)))
Test_output <- t(LMRegtests)
## Adjusting for multiple hypothesis testing
adjp <- apply(Test_output[, grep("p-value", colnames(Test_output))],
              MARGIN = 2, p.adjust, method = "bonferroni")
colnames(adjp) <- sub("value", "adj", colnames(adjp))
Test_output <- cbind(Test_output, adjp)

## perform data normalization (autoscaling)
prot_data_AS <- prot_data
prot_data_AS[, proteins] <- scale(prot_data_AS[, proteins], scale = TRUE)
## do it in one run
LMRegtests_AS <- do.call(cbind.data.frame,
                         lapply(proteins,
                                function(x) FunForLinReg(x, prot_data_AS)))
Test_output_AS <- t(LMRegtests_AS)
EffectSize <- Test_output_AS[, grep("coef", colnames(Test_output_AS))]
colnames(EffectSize) <- sub("coef", "effect_size", colnames(EffectSize))

Test_output <- data.frame(Test_output, EffectSize) 


## Model 2
## do it in one run
LMRegtests2 <- do.call(
    cbind, lapply(proteins, function(x) FunForLinReg2(x, prot_data)))
Test_output2 <- t(LMRegtests2)
## Adjusting for multiple hypothesis testing
adjp <- apply(Test_output2[, grep("p-value", colnames(Test_output2))],
              MARGIN = 2, p.adjust, method = "bonferroni")
colnames(adjp) <- sub("value", "adj", colnames(adjp))
Test_output2 <- cbind(Test_output2, adjp)

## do it in one run
LMRegtests2_AS <- do.call(cbind.data.frame,
                         lapply(proteins,
                                function(x) FunForLinReg2(x, prot_data_AS)))
Test_output2_AS <- t(LMRegtests2_AS)
EffectSize <- Test_output2_AS[, grep("coef", colnames(Test_output2_AS))]
colnames(EffectSize) <- sub("coef", "effect_size", colnames(EffectSize))

Test_output2 <- data.frame(Test_output2, EffectSize) 
```


Now we compare the standardized coefficients or effect sizes as well as the 
p-values for the sex, age, BMI, Fasting and Sex-hormone medications on 
metabolite concentration from the linear models with and without interactions.


### Effect on Sex

```{r , fig.path = IMAGE_PATH, fig.width = 10, fig.height = 5, fig.cap = "Comparison of effect sizes (left) and (-log10) p-values from the linear regression analysis without (x-axis) and with interactions (y-axis)."}
par(mfrow = c(1, 2))
plot(Test_output[,"effect_size_SexFemale"], 
     Test_output2[,"effect_size_SexFemale"], 
     xlab = "Effect Size", ylab = "Effect Size adj", main = "coefficients",
     pch = 21, col = "#00000080", bg = "#00000040")
grid()
abline(0, 1)
plot(-log10(Test_output[,"p.value_SexFemale"]),
     -log10(Test_output2[,"p.value_SexFemale"]),
     xlab = expression(-log[10](p-value)),
     ylab = expression(-log[10](p-value[adj])),
     main = "p-values", pch = 21, col = "#00000080", bg = "#00000040")
grid()
abline(0, 1)
```

Interactive plots are shown below.

```{r}
g <- ggplot(data.frame(EffectSize = Test_output[,"effect_size_SexFemale"],
                       EffectSize_adj = Test_output2[,"effect_size_SexFemale"],
                       metabolite = rownames(Test_output)),
            aes(x = EffectSize, y = EffectSize_adj)) +
    geom_point(aes(alpha =  0.5, text = metabolite)) +
    geom_abline(intercept = 0, slope = 1, alpha = 0.3)
ggplotly(g)
```


```{r}
g <- ggplot(data.frame(pvalue = -log10(Test_output[,"p.value_SexFemale"]),
                       pvalue_adj = -log10(Test_output2[,"p.value_SexFemale"]),
                       metabolite = rownames(Test_output)),
            aes(x = pvalue, y = pvalue_adj)) +
    geom_point(aes(alpha =  0.5, text = metabolite)) +
    geom_abline(intercept = 0, slope = 1, alpha = 0.3) +
    geom_hline(yintercept = -log10(0.05), alpha = 0.3) +
    geom_vline(xintercept = -log10(0.05), alpha = 0.3)
ggplotly(g)
```



### Effect on Age

```{r , fig.path = IMAGE_PATH, fig.width = 10, fig.height = 5, fig.cap = "Comparison of effect sizes (left) and (-log10) p-values from the linear regression analysis without (x-axis) and with interactions (y-axis)."}
par(mfrow = c(1, 2))
plot(Test_output[,"effect_size_Age_10"], 
     Test_output2[,"effect_size_Age_10"], 
     xlab = "Effect Size", ylab = "Effect Size adj", main = "coefficients",
     pch = 21, col = "#00000080", bg = "#00000040")
grid()
abline(0, 1)
plot(-log10(Test_output[,"p.value_Age_10"]),
     -log10(Test_output2[,"p.value_Age_10"]),
     xlab = expression(-log[10](p-value)),
     ylab = expression(-log[10](p-value[adj])),
     main = "p-values", pch = 21, col = "#00000080", bg = "#00000040")
grid()
abline(0, 1)
```

Interactive plots are shown below.

```{r}
g <- ggplot(data.frame(EffectSize = Test_output[,"effect_size_Age_10"],
                       EffectSize_adj = Test_output2[,"effect_size_Age_10"],
                       metabolite = rownames(Test_output)),
            aes(x = EffectSize, y = EffectSize_adj)) +
    geom_point(aes(alpha =  0.5, text = metabolite)) +
    geom_abline(intercept = 0, slope = 1, alpha = 0.3)
ggplotly(g)
```


```{r}
g <- ggplot(data.frame(pvalue = -log10(Test_output[,"p.value_Age_10"]),
                       pvalue_adj = -log10(Test_output2[,"p.value_Age_10"]),
                       metabolite = rownames(Test_output)),
            aes(x = pvalue, y = pvalue_adj)) +
    geom_point(aes(alpha =  0.5, text = metabolite)) +
    geom_abline(intercept = 0, slope = 1, alpha = 0.3) +
    geom_hline(yintercept = -log10(0.05), alpha = 0.3) +
    geom_vline(xintercept = -log10(0.05), alpha = 0.3)
ggplotly(g)
```

### Effect on BMI

```{r , fig.path = IMAGE_PATH, fig.width = 10, fig.height = 5, fig.cap = "Comparison of effect sizes (left) and (-log10) p-values from the linear regression analysis without (x-axis) and with interactions (y-axis)."}
par(mfrow = c(1, 2))
plot(Test_output[,"effect_size_BMIcat4"], 
     Test_output2[,"effect_size_BMIcat4"], 
     xlab = "Effect Size", ylab = "Effect Size adj", main = "coefficients",
     pch = 21, col = "#00000080", bg = "#00000040")
grid()
abline(0, 1)
plot(-log10(Test_output[,"p.value_BMIcat4"]),
     -log10(Test_output2[,"p.value_BMIcat4"]),
     xlab = expression(-log[10](p-value)),
     ylab = expression(-log[10](p-value[adj])),
     main = "p-values", pch = 21, col = "#00000080", bg = "#00000040")
grid()
abline(0, 1)
```

Interactive plots are shown below.

```{r}
g <- ggplot(data.frame(EffectSize = Test_output[,"effect_size_BMIcat4"],
                       EffectSize_adj = Test_output2[,"effect_size_BMIcat4"],
                       metabolite = rownames(Test_output)),
            aes(x = EffectSize, y = EffectSize_adj)) +
    geom_point(aes(alpha =  0.5, text = metabolite)) +
    geom_abline(intercept = 0, slope = 1, alpha = 0.3)
ggplotly(g)
```


```{r}
g <- ggplot(data.frame(pvalue = -log10(Test_output[,"p.value_BMIcat4"]),
                       pvalue_adj = -log10(Test_output2[,"p.value_BMIcat4"]),
                       metabolite = rownames(Test_output)),
            aes(x = pvalue, y = pvalue_adj)) +
    geom_point(aes(alpha =  0.5, text = metabolite)) +
    geom_abline(intercept = 0, slope = 1, alpha = 0.3) +
    geom_hline(yintercept = -log10(0.05), alpha = 0.3) +
    geom_vline(xintercept = -log10(0.05), alpha = 0.3)
ggplotly(g)
```



### Effect on Fasting

```{r , fig.path = IMAGE_PATH, fig.width = 10, fig.height = 5, fig.cap = "Comparison of effect sizes (left) and (-log10) p-values from the linear regression analysis without (x-axis) and with interactions (y-axis)."}
par(mfrow = c(1, 2))
plot(Test_output[,"effect_size_FastingNo"], 
     Test_output2[,"effect_size_FastingNo"], 
     xlab = "Effect Size", ylab = "Effect Size adj", main = "coefficients",
     pch = 21, col = "#00000080", bg = "#00000040")
grid()
abline(0, 1)
plot(-log10(Test_output[,"p.value_FastingNo"]),
     -log10(Test_output2[,"p.value_FastingNo"]),
     xlab = expression(-log[10](p-value)),
     ylab = expression(-log[10](p-value[adj])),
     main = "p-values", pch = 21, col = "#00000080", bg = "#00000040")
grid()
abline(0, 1)
```

Interactive plots are shown below.

```{r}
g <- ggplot(data.frame(EffectSize = Test_output[,"effect_size_FastingNo"],
                       EffectSize_adj = Test_output2[,"effect_size_FastingNo"],
                       metabolite = rownames(Test_output)),
            aes(x = EffectSize, y = EffectSize_adj)) +
    geom_point(aes(alpha =  0.5, text = metabolite)) +
    geom_abline(intercept = 0, slope = 1, alpha = 0.3)
ggplotly(g)
```


```{r}
g <- ggplot(data.frame(pvalue = -log10(Test_output[,"p.value_FastingNo"]),
                       pvalue_adj = -log10(Test_output2[,"p.value_FastingNo"]),
                       metabolite = rownames(Test_output)),
            aes(x = pvalue, y = pvalue_adj)) +
    geom_point(aes(alpha =  0.5, text = metabolite)) +
    geom_abline(intercept = 0, slope = 1, alpha = 0.3) +
    geom_hline(yintercept = -log10(0.05), alpha = 0.3) +
    geom_vline(xintercept = -log10(0.05), alpha = 0.3)
ggplotly(g)
```


### Effect on Sex-hormones

```{r , fig.path = IMAGE_PATH, fig.width = 10, fig.height = 5, fig.cap = "Comparison of effect sizes (left) and (-log10) p-values from the linear regression analysis without (x-axis) and with interactions (y-axis)."}
par(mfrow = c(1, 2))
plot(Test_output[,"effect_size_Sex_hormYes"], 
     Test_output2[,"effect_size_Sex_hormYes"], 
     xlab = "Effect Size", ylab = "Effect Size adj", main = "coefficients",
     pch = 21, col = "#00000080", bg = "#00000040")
grid()
abline(0, 1)
plot(-log10(Test_output[,"p.value_Sex_hormYes"]),
     -log10(Test_output2[,"p.value_Sex_hormYes"]),
     xlab = expression(-log[10](p-value)),
     ylab = expression(-log[10](p-value[adj])),
     main = "p-values", pch = 21, col = "#00000080", bg = "#00000040")
grid()
abline(0, 1)
```

Interactive plots are shown below.

```{r}
g <- ggplot(data.frame(EffectSize = Test_output[,"effect_size_Sex_hormYes"],
                       EffectSize_adj = Test_output2[,"effect_size_Sex_hormYes"],
                       metabolite = rownames(Test_output)),
            aes(x = EffectSize, y = EffectSize_adj)) +
    geom_point(aes(alpha =  0.5, text = metabolite)) +
    geom_abline(intercept = 0, slope = 1, alpha = 0.3)
ggplotly(g)
```


```{r}
g <- ggplot(data.frame(pvalue = -log10(Test_output[,"p.value_Sex_hormYes"]),
                       pvalue_adj = -log10(Test_output2[,"p.value_Sex_hormYes"]),
                       metabolite = rownames(Test_output)),
            aes(x = pvalue, y = pvalue_adj)) +
    geom_point(aes(alpha =  0.5, text = metabolite)) +
    geom_abline(intercept = 0, slope = 1, alpha = 0.3) +
    geom_hline(yintercept = -log10(0.05), alpha = 0.3) +
    geom_vline(xintercept = -log10(0.05), alpha = 0.3)
ggplotly(g)
```

# Data visualization

Top 3 significant proteins for "Age" according to regression analyses are 
plotted in scater plots with age and colored according sex, and regression line 
is added.


```{r, SP_Age_1_figure, fig.path = IMAGE_PATH, fig.width = 3, fig.height = 6}
scatter_plot <- function(data, aes, protein) {
    ggplot(data, aes) +
    geom_jitter(aes(colour = Sex), position=position_jitter(0.05)) +
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    panel.background = element_blank()) +
    ggpubr::stat_cor(method = "pearson", label.x.npc = "middle",
    label.y.npc = "top", col="black") + 
    labs(title = protein) +  ylab("Adjusted conc.") +
    scale_color_manual(values=c("blue", "red")) +
    geom_smooth(method = "lm", se = FALSE, color="black") +
    theme_bw()
    }
    
##
LMReg_1 <- lm(`P35858;P35858-2` ~ Sex + Age + Fasting + BMIcat + Sex_horm,
              data = prot_data)
LMReg_2 <- lm(`P35858;P35858-2` ~ Sex + Fasting + BMIcat + Sex_horm,
              data = prot_data)
residualS <- data.frame(LMReg_2$residuals)
ResData <- cbind.data.frame(model.frame(LMReg_1),residualS)

a_1 <- scatter_plot(ResData, aes(x = Age, y = `LMReg_2.residuals`),
                    protein  = "P35858;P35858-2")
ggplotly(a_1)
```

```{r, SP_Age_2_figure, fig.path = IMAGE_PATH, fig.width = 3, fig.height = 6}

LMReg_1 <- lm(`P04004` ~ Sex + Age + Fasting + BMIcat + Sex_horm,
              data = prot_data)
LMReg_2 <- lm(`P04004` ~ Sex + Fasting + BMIcat + Sex_horm,
              data = prot_data)
residualS <- data.frame(LMReg_2$residuals)
ResData <- cbind.data.frame(model.frame(LMReg_1),residualS)
##
a_2 <- scatter_plot(ResData, aes(x = Age, y = LMReg_2.residuals), 
                    protein  = "P04004")
ggplotly(a_2)
```

```{r, SP_Age_3_figure, fig.path = IMAGE_PATH, fig.width = 3, fig.height = 6}

LMReg_1 <- lm(`P02787` ~ Sex + Age + Fasting + BMIcat + Sex_horm,
              data = prot_data)
LMReg_2 <- lm(`P02787` ~ Sex + Fasting + BMIcat + Sex_horm,
              data = prot_data)
residualS <- data.frame(LMReg_2$residuals)
ResData <- cbind.data.frame(model.frame(LMReg_1),residualS)
##
a_3 <- scatter_plot(ResData, aes(x = Age, y = LMReg_2.residuals), 
                    protein  = "P02787")
ggplotly(a_3)
```



# Session information

R packages used for the analysis:

```{r}
sessionInfo()
```


# References
